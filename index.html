<!DOCTYPE html>
<!-- saved from url=(0052)https://guides.github.com/introduction/git-handbook/ -->
<html lang="en">
    <head>
      <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

      <title>Lab 5 - Charts </title>

      <meta name="viewport" content="width=device-width,initial-scale=1">

      <link rel="icon" href="pie-chart.png" >

      <link rel="stylesheet" href="gridism.css">
      <link rel="stylesheet" href="markdown.css">
      <link rel="stylesheet" href="octicons.css">
      <link href="main.css" rel="stylesheet">
      <link href="pygments.css" rel="stylesheet">

      <link href="font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
      <link href="prism.css" rel="stylesheet" />

      <script type="text/javascript" async="" src="ga.js"></script><script src="jquery.js" type="text/javascript"></script>
      <script src="snap.svg-min.js" type="text/javascript"></script>
      <script src="application.js" type="text/javascript"></script>

      <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-3769691-29']);
        _gaq.push(['_trackPageview']);
        (function() {
          var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
          ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
          var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
      </script>

    </head>

    <body style="background-color:#641E16">

        <article class="full">
            <div class="article-heading js-article-heading js-geopattern" style="background-color:#641E16">
                <div class="wrap">
                  
                   <h1>Lab 5. Map and Charts <i class="fa fa-leaf"></i></h1> 
                  <h3 style="color:#F6F20D"><b><i class="fa fa-spinner fa-spin"></i>  Due: 11:59 pm, Wednesday, 10/31</b></h3>
                </div>
            </div>

            <div class="wrap">
                <div class="toc-wrapper"><ol class="toc js-toc sticky"></ol></div>

                <div class="markdown-body content-body">


                  <p><a id="overview" title="Overview" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Overview</h3>
                  <p><i class="fa fa-spinner fa-spin"></i>  In Lab 3, we have introduced the steps of making an interactive choropleth map in Lab 3.  There are many different ways and ideas to add interactions to web maps. In this exercise, we will explore the combination of charts and maps to display charts as tooltips (you can scroll down the bottom to see <a href="#final"><b>an example of the final product</b></a>)</p>
                    <p><i class="fa fa-spinner fa-spin"></i>  For this week's review assignment (found on D2L), you will make stand-alone charts using the <a href="https://c3js.org/" target="_blank">C3 library</a>. For binding the charts with maps as tooltips, we use the same c3 functions and specifications. However, the procedures are slightly different that you will learn through this lab. </p>
                    <p><i class="fa fa-spinner fa-spin"></i>  Please read the instructions carefully (including the explanations of each step) and complete the assignment in the <a href="#deliverable">Deliverables</a> section at the bottom. </p>


                    
                  <p><a id="data" title="Prepare Data" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Prepare Data</h3>
                    
                     <p>First, let's spend some time to prepare the data to be used for this lab. Since we've done this in lab3, only general steps are provided below. If you forgot the details of some particular steps, please refer to the <a href="https://neiugis.github.io/lab3/" target="_blank">Lab 3 instructions</a>.</p>
                          <ul>
                            <li>Create a <b>new file folder</b> (e.g., lab5) for this lab.</li>
                          <li ><span style="font-weight:bold;color:red;">Getting Data: click <a href="https://drive.google.com/file/d/0BzvZaHCgmEmNZGxza2FzRFQ1Ym8/view?usp=sharing" target="_blank">here</a> to download my sample data.</span> If you are confident, you may go ahead and get the <a href="#deliverable">assignment data</a>.</li>
                          <li>Extract the files to your desired directory.</li>
                          <li>Open <b>QGIS</b> and add the shapefile. Take a look at its attribute table, which contains the demographic data of the Greater London area at borough level. Please familiarize yourself with the field names:
                            <ul><li style="font-size:18px">Specifically, <b>Total</b> refers to total population in 2011. There are five fields containing population count for the different ethnic groups: <b>White</b>, <b>Black</b>, <b>Asian</b>, <b>Mixed</b>, <b>Other</b>. </li>
                                <li><b>pop_den</b> contains the population density in people/hectare. </li>
                                <li><b>NAME</b> gives the name of each borough.</li>
                              <li>We will be mapping population density in graduated colors (choropleth map) and attach charts to each borough to show their ethnic composition.
                                </li></ul></li>
                          <li>Check the <b>Map Unit</b> in Project Properties and <b>simplify geometry</b> using an appropriate tolerance value.</li>
                              <li>Decide the <b>data break values</b> (Layer Properties > Style). I will be using 5-class Natural Breaks in this case.</li>
                          <li> Save the layer as a <b>GeoJson</b> file (Be sure to use <b>EPSG:4326 - WGS 84</b> as the projection!!!). </li>
                          <li>Use <b>Atom</b> to open the GeoJSON file, place the following at the very beginning of the GeoJSON document (see image below):
                              <pre><code class="language-javascript">var data =</code></pre>
                           Note the <code>data</code> here is just a variable name. You may use other names as long as you refer to it with the same name later in the L.geoJson function.
                          </li>
                           
                    <li>Save the changed GeoJSON as <code>london.js</code> to your <b>lab5 folder</b>. You may also name the file differently. Note the file extension is <code>.js</code>.</li>
                        </ul>    

                  <p><a id="prep" title="Create the Choropleth Map" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Create the Choropleth Map with Legend</h3>
                    <p>We will first create the choropleth map with legend. This is basically what we have done in lab 3.</p>
                  <ul>

                          <li>Open your <b>code editor</b> and add the following lines. <br>
                              Note we are <b>NOT using the full mode for now</b> as the chart will be first added below the map. <br>
<pre><code class="language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Lab 5&lt;/title&gt;

        &lt;link rel=&quot;stylesheet&quot; href=&quot;https://unpkg.com/leaflet@1.3.4/dist/leaflet.css&quot;
        integrity=&quot;sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA==&quot;
        crossorigin=&quot;&quot;/&gt;

        &lt;script src=&quot;https://unpkg.com/leaflet@1.3.4/dist/leaflet.js&quot;
        integrity=&quot;sha512-nMMmRyTVoLYqjP9hrbed9S+FzjZHW5gY1TWCHA5ckwXZBadntCNs8kEqAWdrb9O7rxbCaA4lKTIWjDXZxflOcA==&quot;
        crossorigin=&quot;&quot;&gt;&lt;/script&gt;

        &lt;script type=&quot;text/javascript&quot; src=&quot;london.js&quot;&gt;&lt;/script&gt;

        &lt;style type=&quot;text/css&quot;&gt;
            /* Style of the Legend: adjust the values below to change the appearance of the legend pane*/
            .legend {
                padding: 6px 8px;
                line-height: 18px;
                background: rgba(255,255,255,0.9);
                box-shadow: 0 0 15px rgba(0,0,0,0.2);
                border-radius: 5px;
            }

            /* Adjust the values below to change the appearance of the legend color boxes */
            .legend i {
                width: 18px;
                height: 18px;
                float: left;
                margin-right: 8px;
                opacity: 0.7;
            }
        &lt;/style&gt;

    &lt;/head&gt;

    &lt;body&gt;
        &lt;div id=&quot;map&quot; style=&quot;height: 500px&quot;&gt;&lt;/div&gt;
        
        &lt;script type=&quot;text/javascript&quot;&gt;

            var map = L.map('map', {
              center: [51.48,-0.07],
              zoom: 10
            });

            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token={accessToken}', {
                attribution: 'Map data &copy; OpenStreetMap contributors, CC-BY-SA, Imagery &copy; Mapbox',
                maxZoom: 11,
                minZoom: 8,
                id: 'mapbox.light',
                accessToken: 'your mapbox public access token'
            }).addTo(map);

            function getColor(value) {
                return value &gt; 139 ? '#54278f':
                       value &gt; 87  ? '#756bb1':
                       value &gt; 53  ? '#9e9ac8':
                       value &gt; 32  ? '#cbc9e2':
                                     '#f2f0f7';
            }

            function style(feature){
                return {
                    fillColor: getColor(feature.properties.pop_den),   // pop_den is the field name for the population density data
                    weight: 2,
                    opacity: 1,
                    color: 'gray',
                    fillOpacity: 0.9
                };
            }
            
            function highlightFeature(e) {
                var layer = e.target;
                
                // You can adjust the values below to change the highlighting styles of features on mouseover
                layer.setStyle({
                    weight: 5,
                    color: '#666',
                    dashArray: '6', // defines the stroke dash pattern; check out the link for more: https://goo.gl/AWl5sC  
                    fillOpacity: 0.7
                });

                // Fix display layer problems with IE and Opera (no need to change anything)
                if (!L.Browser.ie &amp;&amp; !L.Browser.opera) {
                    layer.bringToFront();
                }         
            }
        
            var geojson;
            
            function resetHighlight(e) {
                geojson.resetStyle(e.target);

            }

            // Combine the mouseover and mouseout actions (defined above)
            function onEachFeature(feature, layer) {
                layer.on({
                    mouseover: highlightFeature,
                    mouseout: resetHighlight,
                });
            }
                       
            geojson = L.geoJson(data, {
                style:style,
                onEachFeature: onEachFeature
            }).addTo(map);
            
            var legend = L.control({position: 'bottomright'}); // Try the other three corners if you like.

            legend.onAdd = function (map) {

                var div = L.DomUtil.create('div', 'legend'),
                    grades = [0, 32, 53, 87, 139]; // The break values to define the intervals of population, note we begin from 0 here

                div.innerHTML = '&lt;b&gt;Population Density &lt;br&gt; 2011 &lt;br&gt;&lt;/b&gt;'; // The legend title (HTML-based), in this case it's Population Density 2011

                // Loop through our the classes and generate a label with a color box for each interval.
                // If you are creating a choropleth map, you DO NOT need to change lines below.
                for (var i = 0; i &lt; grades.length; i++) {
                    div.innerHTML +=
                    '&lt;i style=&quot;background:' + getColor(grades[i] + 1) + '&quot;&gt;&lt;/i&gt;' +
                    grades[i] + (grades[i + 1] ? '&amp;ndash;' + grades[i + 1] + '&lt;br&gt;' : '+');
                }

                return div;
            };

            legend.addTo(map);

        &lt;/script&gt;
   &lt;/body&gt;
&lt;/html&gt;</code></pre>
                               </li>
            <li>Note you will need to use <code>your MapBox access token</code>. </li>     
           <li>Then, save the document as <code>map5.html</code> in your lab 5 folder. </li>   
            <li>Basically, we created the choropleth map, with legend and mouseover events (features are highlighted when mouseover). There is no tooltip added yet at this point (see the example below):</li>
                      <iframe src="map/choropleth.html" width=95% height=570 frameborder=0></iframe>
          </ul>
               
                    
                    
                  <p><a id="chart" title="Make the Charts" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Make the Charts</h3>
                    <p>We use <a href="https://c3js.org/" target="_blank">C3</a> for making the charts. C3 is a D3-based reusable chart library, which contains ready-to-use functions for chart making.</p>
                <ul>
                    <li>First, we need to include the C3 library in the html document. Place the following lines in the <code>head</code> section.
                        <pre><code class="language-html">&lt;!-- Load c3.css --&gt;
&lt;link href=&quot;https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.8/c3.css&quot; rel=&quot;stylesheet&quot;&gt;

&lt;!-- Load d3.js and c3.js --&gt;
&lt;script src=&quot;https://d3js.org/d3.v5.min.js&quot;&gt;&lt;/script&gt;
&lt;script src=&quot;https://cdnjs.cloudflare.com/ajax/libs/c3/0.6.8/c3.min.js&quot;&gt;&lt;/script&gt;</code></pre>
                    Note that we also included the d3.js here as C3 uses functions from D3.</li>
                    
                    <li>Next, create a <code>div</code> as a placeholder for adding the chart. You may place the line right below the map div to stay organized.
                    <pre><code class="language-html">&lt;div id=&quot;chart&quot;&gt;&lt;/div&gt;</code></pre></li>
                    <li>To make the charts using the attribute data, we will define a function. I will call the function <code>makeChart</code>. You may use a different name. Place the function BEFORE the <code>highlightFeature()</code> function. Please read the comment lines for explanation.
                    <pre><code class="language-javascript">function makeChart(props) {
// props is just a variable, which will be replaced with the layer's properties when using the function
    c3.generate({   
    
        bindto: '#chart',  // id of the chart div

        size: {  // size of the chart, by pixels
            height: 180,
            width: 180        
        },

        title:{
            text: props.NAME  // use borough name as the chart title 
        },

        data: {
            columns: [  // use the attribute values as data for making the charts
                ['White', props.White],
                ['Black', props.Black],
                ['Asian', props.Asian],
                ['Mixed', props.Mixed],
                ['Other', props.Other]
            ],

            type: 'donut',  // chart type
        },

        donut:{ // options to customize the donut chart
            label: {
                show: false // set to not show labels on the slides
            },
            width: 30  // width of donut
        },

        color:{ // colors of donut slices
            pattern:["#EC7063", "#5DADE2","#27AE60","#F4D03F","#E67E22"]
        }
    });
}</code></pre>
                    Note the charts will not show up at this point, as we haven't actually used the function for making the charts.<br>
                    The <code>c3.generate()</code> is the C3 function for making charts and we define detailed functions for making different types of charts and customize chart styles. <br>
                    <b>Although we may follow similar syntax/format when making different charts using C3, please DO check the examples and documentations before making a new type of chart.</b>
                    <ul>
                        <li>For example of making other types of charts, refer to the <a href="https://c3js.org/examples.html" target="_blank">C3 Examples page</a>.</li>
                        <li>For more options of customizing charts, refer to the <a href="https://c3js.org/reference.html" target="_blank">C3 Reference page</a>.</li></ul></li> 
                    
                    <li>INSIDE the <code>highlightFeature()</code> function, add the following line to make the chart as part of the mouseover event.
                    <pre><code class="language-javascript">makeChart(layer.feature.properties);</code></pre>
                    The <code>layer.feature.properties</code> will replace the <code>props</code> variable for defining the function, which enables access to the actual attributes/properties of the geojson file.</li>
                    
                    <li>The chart shows up below the map as a section when you hover on a borough. Hover on each feature to see an example so far (<a href="https://raw.githubusercontent.com/neiugis/lab5/gh-pages/map/chart.html" target="_blank">sample code</a>)</li>
                     <iframe src="map/chart.html" width=95% height=710 frameborder=0></iframe></ul>
                                      
                    
                    
                <p><a id="tooltip" title="Add Charts as Tooltips" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Add Charts as Tooltips</h3>   
                    <p>Next, we will take a few more steps to make the charts as popups/tooltips. To do this, we will get the chart element and use it as the tooltip using the <code>bindTooltip</code> method of L.geoJson (introduced in Lab 3).</p>
                    <ul>
                    <li>To get the chart element, place the following line BEFORE <code>L.geoJson</code> so that we have the chart element to be bound as tooltips when adding the geojson layer.                       
                        <pre><code class="language-javascript">var tooltip = document.getElementById("chart");</code></pre>
                        Note the <code><span style="color: #690">"chart"</span></code> here refers to the <code>div</code> element with id "chart".<br><code>document.getElementById</code> is the JavaScript function for finding an html element by id.</li>
                    <li>Next, add the <code>bindTooltip(tooltip)</code> to the <code>L.geoJson</code> function. Note the <code>tooltip</code> is the variable name we used for holding the chart element:
                     <pre><code class="language-javascript">geojson = L.geoJson(data, {
            style:style,
            onEachFeature: onEachFeature
        }).bindTooltip(tooltip).addTo(map);</code></pre></li>
                    <li>Below is the final map with charts as tooltips (<a href="https://raw.githubusercontent.com/neiugis/lab5/gh-pages/map/map5.html" target="_blank">sample code</a>)</li>
                    <iframe id="final" src="map/map5.html" width=95% height=520 frameborder=0></iframe></ul>
                    
                    
                    
                  <p><a id="deliverable" title="Deliverables" class="toc-item"></a></p>
                  <h3><i class="fa fa-paint-brush"></i> Deliverables</h3>
                     <p>For this lab, there are <b>two datasets you may choose ONE</b> for making your final map: </p>
                    <ul>
                        
                    <li><a href="https://drive.google.com/file/d/1jlZMJRFz2tIMnvK2MR9jBFCxuT6iMBKe/view?usp=sharing" target="_blank">Chicago ethnic groups and income at Census tract level</a>, OR</li>
                        <li><a href="https://drive.google.com/file/d/1FKacNiElJhvoIxKw2BopRtaaHiRskGGR/view?usp=sharing" target="_blank">U.S. age groups by state</a>.</li></ul>
                   

                   <p>You may need to <b>calculate new field(s)</b> for producing the final maps, click <a href="https://docs.qgis.org/2.14/en/docs/user_manual/working_with_vector/field_calculator.html" target="_blank">here</a> to learn how Field Calculator works in QGIS. It is possible to calculate new field using math operators and more complicated functions. In addition, you could calculate polygon areas in QGIS, which would be useful for standardizing aggregated data. I have made two short tutorials and hope they are helpful:</p>
                    <ul><li><a href="CalculateArea.pdf" target="_blank">Calculate polygon areas</a> in QGIS.</li>
                        <li><a href="CalculateDensity.pdf" target="_blank">Calculate population density</a> in QGIS, given a total population field and a total area field (in appropriate areal unit for measuring population density, e.g., square miles, square kilometers).</li></ul>
                        Then, create TWO maps in <mark>FULL SCREEN MODE</mark> with the dataset you have selected:
                    <ul><li>A <mark>choropleth map with pie (NOT <strike>donut</strike>) charts</mark> as popups or tooltips when mouseover. Make sure to use <mark>appropriate attributes (standardized data) and classes</mark> for the choropleth map. 
                        </li>
                        <li>Another <mark>choropleth map with a different type (not <strike>pie</strike> or <strike>donut</strike>) of charts</mark> as popups or tooltips when mouseover. 
                        </li>
                        <li>Your final map will be graded based on its <b>overall design and accuracy, e.g., proper use of attributes and charts, colors, labels, choropleth map symbols and data classification, etc.</b></li>
                        <li>Host your two maps separately via GitHub (Make sure to rename the html file as <code>index.html</code> and upload any associated data files to the repository!!!) and submit the two urls through <a href="https://neiu.desire2learn.com/d2l/lms/dropbox/admin/mark/folder_submissions_users.d2l?db=74998&ou=2924591" target="_blank">D2L</a>. </li><br>
                        
                    </ul>

            <br><br>
            </div>
            </div>
        </article>

          <footer>
            <div class="wrap">

              <p>Copyright &copy; Ting Liu 2018</p>
            <div>Icons made by <a href="http://www.freepik.com" title="Freepik">Freepik</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a> is licensed by <a href="http://creativecommons.org/licenses/by/3.0/" title="Creative Commons BY 3.0" target="_blank">CC 3.0 BY</a></div>
            </div>
          </footer>

            <script src="prism.js"></script>

     </body>
</html>
